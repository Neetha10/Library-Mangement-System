<!DOCTYPE html>
<html>
<head>
  <title>My Invoices</title>
</head>
<body>
  <h1>üìÑ My Invoices</h1>
  <div id="invoiceList">Loading...</div>

  <script>
    async function fetchInvoices() {
      const token = localStorage.getItem('token');
      const res = await fetch('/api/invoices', {
        headers: {
          Authorization: 'Bearer ' + token
        }
      });
      const invoices = await res.json();
      const container = document.getElementById('invoiceList');
      container.innerHTML = '';

      if (invoices.length === 0) {
        container.innerHTML = '<p>No invoices found.</p>';
        return;
      }

      invoices.forEach(inv => {
        const div = document.createElement('div');
        div.innerHTML = `
          <hr>
          <p><b>Invoice ID:</b> ${inv.INVOICE_ID}</p>
          <p><b>Book:</b> ${inv.BOOK_NAME}</p>
          <p><b>Copy ID:</b> ${inv.COPY_ID}</p>
          <p><b>Amount:</b> ‚Çπ${inv.INVOICE_AMOUNT}</p>
          <p><b>Date:</b> ${inv.INVOICE_DATE}</p>
        `;
        container.appendChild(div);
      });
      invoices.forEach(inv => {
  const div = document.createElement('div');
  div.innerHTML = `
    <hr>
    <p><b>Invoice ID:</b> ${inv.INVOICE_ID}</p>
    <p><b>Book:</b> ${inv.BOOK_NAME}</p>
    <p><b>Copy ID:</b> ${inv.COPY_ID}</p>
    <p><b>Amount:</b> ‚Çπ${inv.INVOICE_AMOUNT}</p>
    <p><b>Date:</b> ${inv.INVOICE_DATE}</p>
    <button onclick="returnBook(${inv.COPY_ID}, ${inv.INVOICE_ID})">üîÅ Return Book</button>
  `;
  container.appendChild(div);
});

    }

    async function returnBook(copyId, invoiceId) {
  const token = localStorage.getItem('token');
  const res = await fetch('/api/returns', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ copyId, invoiceId })
  });

  const data = await res.json();
  if (res.ok) {
    alert('‚úÖ Book returned successfully!');
    location.reload();
  } else {
    alert('‚ùå Return failed: ' + data.message);
  }
}


    fetchInvoices();
  </script>
</body>
</html>
